<%
page_title t('.title')
@do_not_use_default_page_layout = true
%>

<div class='contentSection mod-overlap-top-image'>

  <header class='contentSection-header'>

    <h1 class='heading'>
      <%= yield(:page_title) %>
    </h1>

    <div>

      <% if @reforms %>

        <label for="reform">
          <%= t('shared.common.change_reform') %>:
        </label>

        <select class='reform js-become-select2 js-filter-reforms-by-reform' id="reform">

          <% selected = params[:reform].nil? ? 'selected': '' %>
          <option <%= selected %>><%= t('shared.common.all') %></option>

          <% @reforms.each do |reform| %>

            <% selected = params[:reform].present? && params[:reform] == reform.slug ? 'selected': '' %>

            <option <%= selected %> value="<%= reform.slug %>"><%= reform.name %></option>

          <% end %>

        </select>

      <% end %>

      <% if @quarters %>

        <label for="quarter">
          <%= t('shared.common.change_time') %>:
        </label>

        <select class='quarter js-become-select2 js-filter-reforms-by-quarter' id="quarter">

          <option selected><%= t('shared.common.all') %></option>

          <% @quarters.each do |quarter| %>

            <option value="<%= quarter.slug %>"><%= quarter.time_period %></option>

          <% end %>

        </select>

      <% end %>

    </div>

  </header>

  <div class='contentSection-body'>

    <% if @reform_text %>
      <div>
        <%= simple_format_no_tags(@reform_text.content) %>
      </div>
    <% end %>

    <% if @quarters.present? && @reforms.present? && @reform_surveys.present? %>

      <div class='js-become-highchart' data-chart-type='percentage-colorful-reforms-history-time-series' data-id='reforms-history-series'></div>

    <% end %>

  </div>

</div>

<div class='contentSection'>

  <header class='contentSection-header'>

    <h2 class='heading'>
      <%= t('.header.table') %>
    </h2>

  </header>

  <div class='contentSection-body mod-no-padding'>

    <% if @quarters.present? && @reforms.present? && @reform_surveys.present? %>

      <table class='chartsTable'>

        <thead>

          <tr class='chartsTable-row'>

            <th class='chartsTable-cell mod-head mod-first-column'>
              <%= t('.table_header.time') %>
            </th>

            <th class='chartsTable-cell mod-head'>
              <%= t('.table_header.reform') %>
            </th>

            <th class='chartsTable-cell mod-head'>
              <%= t('.table_header.government') %>
            </th>

            <th class='chartsTable-cell mod-head'>
              <%= t('.table_header.stakeholder') %>
            </th>

            <th class='chartsTable-cell mod-head'>
              <%= t('.table_header.summary') %>
            </th>

          </tr>

        </thead>

        <tbody class='chartsTable-body'>

          <% @quarters.each do |quarter| %>

            <% surveys = @reform_surveys.select{|x| x.quarter_id == quarter.id} %>

            <% if surveys.present? %>

              <% surveys.each do |survey| %>

                <% reform = @reforms.select{|x| x.id == survey.reform_id}.first %>

                <% if reform %>

                  <tr class='chartsTable-row js-act-as-reform-table-row'>

                    <td class='chartsTable-cell mod-first-column mod-important-text js-act-as-quarter-name'>
                      <%= link_to(quarter.time_period,
                                  reform_show_path(
                                    reform_id: reform.slug,
                                    quarter_id: quarter.slug),
                                  class: 'link mod-no-decoration') %>
                    </td>

                    <td class='chartsTable-cell mod-important-text js-act-as-reform-name'>
                      <%= link_to(reform.name,
                                  reform_show_path(
                                    reform_id: reform.slug,
                                    quarter_id: quarter.slug),
                                  class: 'link mod-no-decoration') %>
                    </td>

                    <td class='chartsTable-cell'>

                      <div class='js-become-highchart solidGauge mod-small mod-white-border' data-chart-type='small-solid-gauge' data-id='reform-government-<%= quarter.slug %>-<%= reform.slug %>'></div>

                    </td>

                    <td class='chartsTable-cell'>

                      <div class='js-become-highchart meterGauge mod-small' data-chart-type='small-meter-gauge' data-id='reform-stakeholder-<%= quarter.slug %>-<%= reform.slug %>'></div>

                    </td>

                    <td class='chartsTable-cell'>
                      <%= strip_tags_nbsp(reform.summary) %>
                    </td>

                  </tr>

                <% end %>

              <% end %>

            <% end %>

          <% end %>

        </tbody>

      </table>

    <% else %>

      <p class="alert alert-warning">
        <%= t('.no_data') %>
      </p>

    <% end %>

  </div>

</div>
