class ChartsController < ApplicationController
  def create_share_image
    require 'uri'
    require 'net/http'
    require 'fileutils'

    svg = '<svg xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" style="font-family:sans-serif;font-size:9px;" xmlns="http://www.w3.org/2000/svg" width="1410" height="600"><desc>Created with Highcharts 4.2.5</desc><defs><clipPath id="highcharts-53"><rect x="0" y="0" width="1358" height="469"></rect></clipPath><linearGradient x1="0" y1="0" x2="0" y2="1" id="highcharts-54"><stop offset="0" stop-color="rgb(180,100,191)" stop-opacity="1"></stop><stop offset="1" stop-color="rgb(180,100,191)" stop-opacity="0.6"></stop></linearGradient></defs><rect x="0" y="0" width="1410" height="600" fill="#FFFFFF" class=" highcharts-background"></rect><g class="highcharts-grid"></g><g class="highcharts-grid"><path fill="none" d="M 42 529.5 L 1400 529.5" stroke="#E0E0E0" stroke-width="1" stroke-dasharray="1,3" opacity="1"></path><path fill="none" d="M 42 482.5 L 1400 482.5" stroke="#E0E0E0" stroke-width="1" stroke-dasharray="1,3" opacity="1"></path><path fill="none" d="M 42 435.5 L 1400 435.5" stroke="#E0E0E0" stroke-width="1" stroke-dasharray="1,3" opacity="1"></path><path fill="none" d="M 42 388.5 L 1400 388.5" stroke="#E0E0E0" stroke-width="1" stroke-dasharray="1,3" opacity="1"></path><path fill="none" d="M 42 341.5 L 1400 341.5" stroke="#E0E0E0" stroke-width="1" stroke-dasharray="1,3" opacity="1"></path><path fill="none" d="M 42 295.5 L 1400 295.5" stroke="#E0E0E0" stroke-width="1" stroke-dasharray="1,3" opacity="1"></path><path fill="none" d="M 42 248.5 L 1400 248.5" stroke="#E0E0E0" stroke-width="1" stroke-dasharray="1,3" opacity="1"></path><path fill="none" d="M 42 201.5 L 1400 201.5" stroke="#E0E0E0" stroke-width="1" stroke-dasharray="1,3" opacity="1"></path><path fill="none" d="M 42 154.5 L 1400 154.5" stroke="#E0E0E0" stroke-width="1" stroke-dasharray="1,3" opacity="1"></path><path fill="none" d="M 42 107.5 L 1400 107.5" stroke="#E0E0E0" stroke-width="1" stroke-dasharray="1,3" opacity="1"></path><path fill="none" d="M 42 60.5 L 1400 60.5" stroke="#E0E0E0" stroke-width="1" stroke-dasharray="1,3" opacity="1"></path><path fill="none" d="M 42 529.5 L 1400 529.5" stroke="#D8D8D8" stroke-width="1" stroke-dasharray="1,3" opacity="1"></path><path fill="none" d="M 42 295.5 L 1400 295.5" stroke="#D8D8D8" stroke-width="1" stroke-dasharray="1,3" opacity="1"></path><path fill="none" d="M 42 60.5 L 1400 60.5" stroke="#D8D8D8" stroke-width="1" stroke-dasharray="1,3" opacity="1"></path></g><g class="highcharts-axis"><path fill="none" d="M 54.5 529 L 54.5 539" stroke="#C0D0E0" stroke-width="1" opacity="1"></path><path fill="none" d="M 720.5 529 L 720.5 539" stroke="#C0D0E0" stroke-width="1" opacity="1"></path><path fill="none" d="M 1386.5 529 L 1386.5 539" stroke="#C0D0E0" stroke-width="1" opacity="1"></path><path fill="none" d="M 42 529.5 L 1400 529.5" stroke="#C0D0E0" stroke-width="1"></path></g><g class="highcharts-axis"></g><g class="highcharts-series-group"><g class="highcharts-series highcharts-series-0" transform="translate(42,60) scale(1 1)" clip-path="url(#highcharts-53)"><path fill="url(#highcharts-54)" d="M 13.313725490196 171.185 C 13.313725490196 171.185 412.7254901960784 167.3392 679 164.14999999999998 C 945.2745098039198 160.96079999999995 1344.6862745098 155.23899999999992 1344.6862745098 155.23899999999992 L 1344.6862745098 469 C 1344.6862745098 469 945.2745098039198 469 679 469 C 412.7254901960784 469 13.313725490196 469 13.313725490196 469"></path><path fill="none" d="M 13.313725490196 171.185 C 13.313725490196 171.185 412.7254901960784 167.3392 679 164.14999999999998 C 945.2745098039198 160.96079999999995 1344.6862745098 155.23899999999992 1344.6862745098 155.23899999999992" stroke-linejoin="round" stroke-linecap="round"></path></g><g class="highcharts-markers highcharts-series-0" transform="translate(42,60) scale(1 1)" clip-path="none"></g><g class="highcharts-series highcharts-series-1" transform="translate(42,60) scale(1 1)" clip-path="url(#highcharts-53)"><path fill="none" d="M 13.313725490196 140.7 C 13.313725490196 140.7 412.7254901960784 134.134 679 131.32 C 945.2745098039198 128.50600000000003 1344.6862745098 126.63 1344.6862745098 126.63" stroke="#0e3a5b" stroke-width="2.5" stroke-dasharray="2.5,7.5"></path></g><g class="highcharts-markers highcharts-series-1" transform="translate(42,60) scale(1 1)" clip-path="none"></g><g class="highcharts-series highcharts-series-2" transform="translate(42,60) scale(1 1)" clip-path="url(#highcharts-53)"><path fill="none" d="M 13.313725490196 304.85 C 13.313725490196 304.85 412.7254901960784 296.408 679 290.78 C 945.2745098039198 285.15199999999993 1344.6862745098 276.71 1344.6862745098 276.71" stroke="#0e3a5b" stroke-width="2.5" stroke-dasharray="7.5,2.5"></path></g><g class="highcharts-markers highcharts-series-2" transform="translate(42,60) scale(1 1)" clip-path="none"></g><g class="highcharts-series highcharts-series-3" transform="translate(42,60) scale(1 1)" clip-path="url(#highcharts-53)"><path fill="none" d="M 13.313725490196 178.21999999999997 C 13.313725490196 178.21â€¦ts-series highcharts-series-4" transform="translate(42,60) scale(1 1)" clip-path="url(#highcharts-53)"><path fill="none" d="M 13.313725490196 93.79999999999995 C 13.313725490196 93.79999999999995 412.7254901960784 93.79999999999995 679 93.79999999999995 C 945.2745098039198 93.79999999999995 1344.6862745098 84.41999999999996 1344.6862745098 84.41999999999996" stroke="#0e3a5b" stroke-width="2.5" stroke-dasharray="20,7.5"></path></g><g class="highcharts-markers highcharts-series-4" transform="translate(42,60) scale(1 1)" clip-path="none"></g></g><text x="705" text-anchor="middle" class="highcharts-title" style="color:#333333;font-size:18px;fill:#333333;width:1346px;" y="24"><tspan>Reform: Innovations</tspan></text><text x="705" text-anchor="middle" class="highcharts-subtitle" style="color:#555555;font-size:1.4em;fill:#555555;width:1346px;" y="48"><tspan>Government History</tspan></text><g class="highcharts-legend" transform="translate(367,561)"><g><g><g class="highcharts-legend-item" transform="translate(8,3)"><text x="45" style="color:#333333;font-size:12px;font-weight:400;cursor:pointer;fill:#333333;" text-anchor="start" y="15">Overall</text><rect x="0" y="4" width="40" height="12" fill="rgb(180,100,191)" fill-opacity="1"></rect></g><g class="highcharts-legend-item" transform="translate(159.09375,3)"><path fill="none" d="M 0 11 L 40 11" stroke-dasharray="2.5,7.5" stroke="#0e3a5b" stroke-width="2.5"></path><text x="45" y="15" style="color:#333333;font-size:12px;font-weight:400;cursor:pointer;fill:#333333;" text-anchor="start"><tspan>Institutional Setup</tspan></text></g><g class="highcharts-legend-item" transform="translate(366.8125,3)"><path fill="none" d="M 0 11 L 40 11" stroke-dasharray="7.5,2.5" stroke="#0e3a5b" stroke-width="2.5"></path><text x="45" y="15" style="color:#333333;font-size:12px;font-weight:400;cursor:pointer;fill:#333333;" text-anchor="start"><tspan>Capacity Building</tspan></text></g><g class="highcharts-legend-item" transform="translate(569.0625,3)"><path fill="none" d="M 0 11 L 40 11" stroke-dasharray="10,7.5" stroke="#0e3a5b" stroke-width="2.5"></path><text x="45" y="15" style="color:#333333;font-size:12px;font-weight:400;cursor:pointer;fill:#333333;" text-anchor="start"><tspan>Infastructure &amp; Budgeting</tspan></text></g><g class="highcharts-legend-item" transform="translate(813.546875,3)"><path fill="none" d="M 0 11 L 40 11" stroke-dasharray="20,7.5" stroke="#0e3a5b" stroke-width="2.5"></path><text x="45" y="15" style="color:#333333;font-size:12px;font-weight:400;cursor:pointer;fill:#333333;" text-anchor="start"><tspan>Legislation &amp; Regulations</tspan></text></g></g></g></g><g class="highcharts-axis-labels highcharts-xaxis-labels"><text x="55.31372549019608" style="color:#606060;cursor:default;font-size:11px;fill:#606060;width:685px;text-overflow:clip;" text-anchor="middle" transform="translate(0,0)" y="548" opacity="1"><tspan>Q2 2015</tspan></text><text x="721" style="color:#606060;cursor:default;font-size:11px;fill:#606060;width:685px;text-overflow:clip;" text-anchor="middle" transform="translate(0,0)" y="548" opacity="1"><tspan>Q3 2015</tspan></text><text x="1380.3984375" style="color:#606060;cursor:default;font-size:11px;fill:#606060;width:685px;text-overflow:clip;" text-anchor="middle" transform="translate(0,0)" y="548" opacity="1"><tspan>Q4 2015</tspan></text></g><g class="highcharts-axis-labels highcharts-yaxis-labels"><text x="27" style="color:#606060;cursor:default;font-size:11px;fill:#606060;width:455px;text-overflow:clip;" text-anchor="end" transform="translate(0,0)" y="534" opacity="1">0</text><text x="27" style="color:#606060;cursor:default;font-size:11px;fill:#606060;width:455px;text-overflow:clip;" text-anchor="end" transform="translate(0,0)" y="300" opacity="1">50</text><text x="27" style="color:#606060;cursor:default;font-size:11px;fill:#606060;width:455px;text-overflow:clip;" text-anchor="end" transform="translate(0,0)" y="65" opacity="1">100</text></g><g class="highcharts-tooltip" style="cursor:default;padding:0;pointer-events:none;white-space:nowrap;" transform="translate(0,-9999)"><path fill="none" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0"  stroke="black" stroke-opacity="0.049999999999999996" stroke-width="5" transform="translate(1, 1)"></path><path fill="none" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0"  stroke="black" stroke-opacity="0.09999999999999999" stroke-width="3" transform="translate(1, 1)"></path><path fill="none" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0"  stroke="black" stroke-opacity="0.15" stroke-width="1" transform="translate(1, 1)"></path><path fill="white" d="M 3 0 L 13 0 C 16 0 16 0 16 3 L 16 13 C 16 16 16 16 13 16 L 3 16 C 0 16 0 16 0 13 L 0 3 C 0 0 0 0 3 0"></path><text x="8" style="font-size:12px;color:#333333;fill:#333333;" y="20"></text></g></svg>'

    post_params = {
      filename: 'Reform: Innovations_ReforMeter',
      scale: 1,
      type: 'image/png',
      svg: svg
    }

    response = Net::HTTP.post_form(
      URI.parse('http://export.highcharts.com/'),
      post_params
    )

    image_path = Rails.root.join('public', 'system', 'chart_share_images', 'test.png')

    FileUtils::mkdir_p(File.dirname(image_path))

    File.open(image_path, 'wb') do |file|
      file.write response.body
    end
  end
end
